import{d as T,m as A,e as b,_ as w,o as l,c as n,a as e,f as m,g,F as v,h as S,t as d,i as R,w as E,v as U,b as r,j as x,n as y,r as f,k as M,L as Q,l as D}from"./index-BbvUdh_o.js";import{c as k}from"./cartStore-CaAN10cb.js";import{s as $}from"./statusStore-Bmf0kU7H.js";var j={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jeff_hexschool",BASE_URL:"/PorkShop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:B,VITE_PATH:N}=j,q=$(),O={data(){return{userModal:null,editCarts:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{sendOrder(){this.isLoading=!0;let s=`${B}/api/${N}/order`;const o=this.form;T.post(s,{data:o}).then(c=>{this.$refs.form.resetForm(),this.isLoading=!1,c.data.success?(this.getCarts(),q.pushMessage({style:"success",title:"已送出訂單"})):q.pushMessage({danger:"success",title:"送出訂單失敗",content:c.data.message.join("、")})})},isPhone(s){return/^(09)[0-9]{8}$/.test(s)?!0:"電話為必填，須為有效的電話號碼"},...A(k,["getCarts","addToCart","cartChangeQty","delCartItem","delAllCart"])},watch:{},mounted(){},computed:{...b(k,["carts","cartslength"]),...b($,["addCartLoading","cartQtyLoading","delCart"])}},H={class:"text-end"},z=["disabled"],F={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},G={class:"table align-middle"},J=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"170px"}},"數量/單位"),e("th",{style:{width:"120px"}}),e("th",null,"單價"),e("th",null,"小計")])],-1),K=["onClick","disabled"],W={key:0,class:"bi bi-x-lg"},X={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Y={class:"input-group input-group-sm"},Z={class:"input-group mb-3"},ee=["disabled","onClick"],te=["onUpdate:modelValue","disabled"],se=["onClick","disabled"],oe={class:"input-group-text",id:"basic-addon2"},le=e("td",null,null,-1),ae={class:"text-end"},ne={key:0},ie=e("small",{class:"text-success"},"折扣價：",-1),de={key:1},re={key:0,class:"text-end"},ce={key:1,class:"text-end"},ue=e("td",{colspan:"5",class:"text-end"},"總計",-1),pe={class:"text-end"},he={key:0},_e=e("td",{colspan:"5",class:"text-end text-success"},"折扣價",-1),me={class:"text-end text-success"},ge={class:"my-5 row justify-content-center"},ye={class:"mb-3"},fe=e("label",{for:"email",class:"form-label"},"Email",-1),be={class:"mb-3"},ve=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ce={class:"mb-3"},ke=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),$e={class:"mb-3"},Le=e("label",{for:"address",class:"form-label"},"收件人地址",-1),Ve={class:"mb-3"},Pe=e("label",{for:"message",class:"form-label"},"留言",-1),Te={class:"text-end"},Ae=["disabled"];function Se(s,o,c,p,a,h){const _=f("v-field"),u=f("error-message"),L=f("v-form");return l(),n(v,null,[e("div",H,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:o[0]||(o[0]=(...t)=>s.delAllCart&&s.delAllCart(...t)),disabled:s.delCart==="delAll"},[s.delCart==="delAll"?(l(),n("span",F)):m("",!0),g(" 清空購物車 ")],8,z)]),e("table",G,[J,e("tbody",null,[(l(!0),n(v,null,S(s.carts.carts,t=>(l(),n("tr",{key:t.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>s.delCartItem(t.id),disabled:t.id===s.delCart},[t.id!==s.delCart?(l(),n("i",W)):m("",!0),t.id===s.delCart?(l(),n("span",X)):m("",!0)],8,K)]),e("td",null,d(t.product.title),1),e("td",null,[e("div",Y,[e("div",Z,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",style:R(t.qty===1?"display:none;":""),disabled:t.qty===1||t.id===s.cartQtyLoading,onClick:i=>(t.qty--,s.cartChangeQty(t,t.qty,"--"))}," - ",12,ee),E(e("input",{min:"1",type:"number",class:"form-control",style:{"text-align":"center"},"onUpdate:modelValue":i=>t.qty=i,disabled:t.id===s.cartQtyLoading,readonly:""},null,8,te),[[U,t.qty]]),e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:i=>(t.qty++,s.cartChangeQty(t,t.qty,"++")),disabled:t.id===s.cartQtyLoading}," + ",8,se),e("span",oe,d(t.product.unit),1)])])]),le,e("td",ae,[t.product.price<t.product.origin_price?(l(),n("div",ne,[ie,e("del",null,d(t.product.origin_price),1),g(" "+d(t.product.price),1)])):(l(),n("div",de,d(t.product.origin_price),1))]),t.product.price<t.product.origin_price?(l(),n("td",re,d(t.product.price*t.qty),1)):(l(),n("td",ce,d(t.product.origin_price*t.qty),1))]))),128))]),e("tfoot",null,[e("tr",null,[ue,e("td",pe,d(s.carts.total),1)]),s.carts.final_total<s.carts.total?(l(),n("tr",he,[_e,e("td",me,d(s.carts.final_total),1)])):m("",!0)])]),e("div",ge,[r(L,{ref:"form",class:"col-md-6",onSubmit:h.sendOrder},{default:x(({errors:t})=>[e("div",ye,[fe,r(_,{id:"email",name:"email",type:"email",class:y(["form-control",{"is-invalid":t.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:a.form.user.email,"onUpdate:modelValue":o[1]||(o[1]=i=>a.form.user.email=i)},null,8,["class","modelValue"]),r(u,{name:"email",class:"invalid-feedback"})]),e("div",be,[ve,r(_,{id:"name",name:"姓名",type:"text",class:y(["form-control",{"is-invalid":t.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:a.form.user.name,"onUpdate:modelValue":o[2]||(o[2]=i=>a.form.user.name=i)},null,8,["class","modelValue"]),r(u,{name:"姓名",class:"invalid-feedback"})]),e("div",Ce,[ke,r(_,{id:"tel",name:"電話",type:"text",class:y(["form-control",{"is-invalid":t.電話}]),placeholder:"請輸入電話",rules:h.isPhone,modelValue:a.form.user.tel,"onUpdate:modelValue":o[3]||(o[3]=i=>a.form.user.tel=i)},null,8,["class","rules","modelValue"]),r(u,{name:"電話",class:"invalid-feedback"})]),e("div",$e,[Le,r(_,{id:"address",name:"地址",type:"text",class:y(["form-control",{"is-invalid":t.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:a.form.user.address,"onUpdate:modelValue":o[4]||(o[4]=i=>a.form.user.address=i)},null,8,["class","modelValue"]),r(u,{name:"地址",class:"invalid-feedback"})]),e("div",Ve,[Pe,E(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[5]||(o[5]=i=>a.form.message=i)},null,512),[[U,a.form.message]])]),e("div",Te,[e("button",{type:"submit",class:"btn btn-danger",disabled:a.form.user.id===s.cartQtyLoading}," 送出訂單 ",8,Ae)])]),_:1},8,["onSubmit"])])],64)}const xe=w(O,[["render",Se]]);var Ee={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"jeff_hexschool",BASE_URL:"/PorkShop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:V,VITE_PATH:P}=Ee,C=$(),I=M("productStore",{state:()=>({products:[],pages:{},category:[]}),actions:{getProducts(s=1){C.isLoading=!0;let o=`${V}/api/${P}/products?page=${s}`;T.get(o).then(c=>{this.products=c.data.products,this.pages=c.data.pagination;const p=this.products.map(h=>h.category),a=new Set(p);this.category=[...a]}).catch(()=>{this.products=[],this.pages={},this.category=[]}),setTimeout(()=>{C.isLoading=!1},1e3)},filterProducts(s=1,o="all"){C.isLoading=!0;let c=`${V}/api/${P}/products?page=${s}`;o!=="all"&&(c=`${V}/api/${P}/products?page=${s}&category=${o}`),T.get(c).then(p=>{this.products=p.data.products,this.pages=p.data.pagination}).catch(()=>{this.products=[],this.pages={}}),C.isLoading=!1}}}),Ue={data(){return{tempProduct:{},selectID:"",checkProduct:"",tempArry:[],isActive:"all",path:{category:"all",page:1},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{openModal(s){this.$refs.uModal.openModal(),this.checkProduct=s.id,this.tempProduct={...s},setTimeout(()=>{this.checkProduct=""},200)},...A(I,["getProducts","filterProducts"]),...A(k,["getCarts","addToCart","cartChangeQty","delCartItem","delAllCart"]),getPath(){this.path.category=this.$route.query.category||"all",this.path.page=this.$route.query.page||1,this.isActive=this.path.category,this.$router.push(`./products?category=${this.path.category}&page=${this.path.page}`)}},created(){},mounted(){this.getProducts(),this.getPath(),this.getCarts()},components:{Loading:Q,UserCart:xe},computed:{...b(I,["products","pages","category"]),...b(k,["carts","cartslength"]),...b($,["isLoading","addCartLoading","cartQtyLoading","setIsLoading","delCart"])}},qe={class:"container"},Ie={class:"mt-4"},we=e("h2",{class:"d-flex justify-content-center",style:{"margin-top":"75px"}},"商品列表",-1),Re={class:"category list-unstyled d-flex justify-content-center mt-4",style:{"margin-bottom":"50px"}},Me=["onClick"],Qe={class:"row d-flex list-unstyled"},De={class:"img-fluid hovereffect px-3",style:{"background-size":"cover","background-position":"center",width:"100%",height:"250px"}},je=["src","alt","title"],Be={class:"overlay",style:{"margin-top":"100px"}},Ne=["disabled","onClick"],Oe={class:"py-1",style:{"text-align":"center"}},He={class:"products-title m-0",role:"button"},ze={key:0,class:"products-title mt-1",role:"button"},Fe={class:"small"},Ge={class:"small",style:{color:"red"}},Je={key:1,class:"products-title mt-1",role:"button"},Ke={class:"small"},We=["disabled","onClick"],Xe=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),Ye={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function Ze(s,o,c,p,a,h){const _=f("Loading"),u=f("RouterLink"),L=f("UserCart");return l(),n(v,null,[r(_,{active:s.isLoading},null,8,["active"]),e("div",qe,[e("div",Ie,[we,e("ul",Re,[e("li",{class:"p-0 ms-1",onClick:o[0]||(o[0]=t=>(s.filterProducts(1,"all"),a.isActive="all"))},[r(u,{class:y(["btn btn-outline-secondary router-link-active px-3 px-md-4 py-1",a.isActive==="all"?"active":""]),to:{query:{category:"all",page:1}}},{default:x(()=>[g("全部")]),_:1},8,["class"])]),(l(!0),n(v,null,S(s.category,(t,i)=>(l(),n("li",{key:i,class:"p-0 ms-1",onClick:et=>(s.filterProducts(1,t),a.isActive=t)},[r(u,{class:y(["btn btn-outline-secondary router-link-active px-3 px-md-4 py-1",a.isActive===t?"active":""]),to:{query:{category:t,page:1}}},{default:x(()=>[g(d(t),1)]),_:2},1032,["class","to"])],8,Me))),128))]),e("ul",Qe,[(l(!0),n(v,null,S(s.products,t=>(l(),n("li",{class:"col-lg-4 col-md-8",key:t.id},[e("div",De,[e("img",{class:"img-responsive",style:{width:"100%",height:"100%"},src:t.imageUrl,alt:t.title,title:t.title+":"+t.description},null,8,je),e("div",Be,[e("h2",null,d(t.title),1),e("a",{href:"#",type:"button",class:"info",disabled:t.id===a.checkProduct,onClick:i=>h.openModal(t)}," 查看更多 ",8,Ne)])]),e("div",Oe,[e("p",He,d(t.title),1),t.price<t.origin_price?(l(),n("p",ze,[e("del",Fe,"$ "+d(t.origin_price),1),g(" 現在只要  "),e("span",Ge,"$ "+d(t.price),1)])):(l(),n("p",Je,[e("span",Ke,"$ "+d(t.origin_price),1)])),e("button",{type:"button",class:"btn btn-outline-secondary btn-sm mx-auto fs-6",disabled:t.id===s.addCartLoading,onClick:i=>s.addToCart(t.id,1)},[Xe,t.id===s.addCartLoading?(l(),n("span",Ye)):m("",!0),g(" 加入購物車 ")],8,We)])]))),128))]),s.cartslength>0?(l(),D(L,{key:0})):m("",!0)])])],64)}const lt=w(Ue,[["render",Ze]]);export{lt as default};
